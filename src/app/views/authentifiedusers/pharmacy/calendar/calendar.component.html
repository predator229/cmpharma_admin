<div class="calendar-container">
  <!-- Header avec contrôles et stats -->
  <div class="calendar-header">
    <div class="header-left">
      <div class="calendar-navigation">
        <button class="nav-btn" (click)="previousMonth()">
          <i class="fas fa-chevron-left"></i>
        </button>
        <h2 class="current-month">{{ getMonthYear() }}</h2>
        <button class="nav-btn" (click)="nextMonth()">
          <i class="fas fa-chevron-right"></i>
        </button>
        <button class="today-btn" (click)="goToToday()">Aujourd'hui</button>
      </div>
    </div>

    <div class="header-center">
      <div class="calendar-stats">
        <div class="stat-card">
          <div class="stat-icon orders">
            <i class="fas fa-shopping-cart"></i>
          </div>
          <div class="stat-info">
            <span class="stat-value">{{ calendarStats.totalOrders }}</span>
            <span class="stat-label">Commandes</span>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon completed">
            <i class="fas fa-check-circle"></i>
          </div>
          <div class="stat-info">
            <span class="stat-value">{{ calendarStats.completedOrders }}</span>
            <span class="stat-label">Terminées</span>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon activities">
            <i class="fas fa-bell"></i>
          </div>
          <div class="stat-info">
            <span class="stat-value">{{ calendarStats.totalActivities }}</span>
            <span class="stat-label">Activités</span>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon time">
            <i class="fas fa-clock"></i>
          </div>
          <div class="stat-info">
            <span class="stat-value">{{ formatDuration(calendarStats.averageOrderTime) }}</span>
            <span class="stat-label">Temps moyen</span>
          </div>
        </div>
      </div>
    </div>

    <div class="header-right">
      <div class="calendar-controls">
        <div class="view-modes">
          <button class="view-btn"
                  [class.active]="viewMode === 'month'"
                  (click)="changeViewMode('month')">
            Mois
          </button>
          <button class="view-btn"
                  [class.active]="viewMode === 'week'"
                  (click)="changeViewMode('week')">
            Semaine
          </button>
          <button class="view-btn"
                  [class.active]="viewMode === 'day'"
                  (click)="changeViewMode('day')">
            Jour
          </button>
        </div>
        <button class="control-btn" (click)="refreshCalendar()">
          <i class="fas fa-sync-alt" [class.fa-spin]="isLoading"></i>
        </button>
        <button class="control-btn" (click)="exportCalendar()">
          <i class="fas fa-download"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Filtres -->
  <div class="calendar-filters">
    <div class="filter-group">
      <label>Type:</label>
      <select class="filter-select" (change)="onFilterChange('type', $any($event.target).value)">
        <option value="all">Tous</option>
        <option value="orders">Commandes</option>
        <option value="activities">Activités</option>
      </select>
    </div>
    <div class="filter-group">
      <label>Statut:</label>
      <select class="filter-select" (change)="onFilterChange('status', $any($event.target).value)">
        <option value="all">Tous</option>
        <option value="pending">En attente</option>
        <option value="completed">Terminé</option>
        <option value="cancelled">Annulé</option>
      </select>
    </div>
    <div class="filter-group">
      <label>Priorité:</label>
      <select class="filter-select" (change)="onFilterChange('priority', $any($event.target).value)">
        <option value="all">Toutes</option>
        <option value="high">Haute</option>
        <option value="medium">Moyenne</option>
        <option value="low">Basse</option>
      </select>
    </div>
  </div>

  <!-- Calendrier principal -->
  <div class="calendar-main" *ngIf="!isLoading">
    <div class="calendar-grid" *ngIf="viewMode === 'month'">
      <!-- En-têtes des jours -->
      <div class="calendar-header-row">
        <div class="day-header" *ngFor="let dayName of dayNames">
          {{ dayName }}
        </div>
      </div>

      <!-- Grille des jours -->
      <div class="calendar-body">
        <div class="calendar-day"
             *ngFor="let day of calendarDays; trackBy: trackByDate"
             [class.other-month]="!day.isCurrentMonth"
             [class.today]="day.isToday"
             [class.selected]="day.isSelected"
             [class.has-events]="day.hasEvents"
             (click)="selectDate(day)">

          <div class="day-number">{{ day.date.getDate() }}</div>

          <!-- Indicateurs d'événements -->
          <div class="day-events" *ngIf="day.hasEvents">
            <div class="event-indicators">
              <span class="event-dot orders"
                    *ngIf="day.ordersCount > 0"
                    [title]="day.ordersCount + ' commande(s)'">
                {{ day.ordersCount }}
              </span>
              <span class="event-dot activities"
                    *ngIf="day.activitiesCount > 0"
                    [title]="day.activitiesCount + ' activité(s)'">
                {{ day.activitiesCount }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Détails du jour sélectionné -->
  <div class="calendar-sidebar" *ngIf="selectedDate && selectedDayEvents.length > 0">
    <div class="sidebar-header">
      <h3>{{ selectedDate | date:'EEEE dd MMMM yyyy':'fr-FR' }}</h3>
      <span class="events-count">{{ selectedDayEvents.length }} événement(s)</span>
    </div>

    <div class="sidebar-content">
      <div class="event-item"
           *ngFor="let event of selectedDayEvents; trackBy: trackByEventId"
           [class]="'event-' + event.type"
           (click)="onEventClick(event)">

        <div class="event-time">{{ event.time }}</div>
        <div class="event-content">
          <div class="event-title">{{ event.title }}</div>
          <div class="event-status" [style.background-color]="event.color">
            {{ event.status }}
          </div>

          <!-- Détails spécifiques aux commandes -->
          <div class="event-details" *ngIf="event.type === 'order'">
            <div class="order-details">
              <span class="customer-name">
                {{ 'Client anonyme' }}
<!--                event.type == 'order' ?.customer?.getFullName() || -->
              </span>
              <span class="order-items">
                hehe article(s)
<!--                {{ (event.data as any).getTotalItems() }}-->
              </span>
            </div>
          </div>

          <!-- Détails spécifiques aux activités -->
          <div class="event-details" *ngIf="event.type === 'activity'">
            <div class="activity-details">
              <span class="activity-description">
<!--                {{ (event.data as any).description }}-->
              </span>
            </div>
          </div>
        </div>

        <div class="event-priority" [class]="'priority-' + event.priority">
          <i class="fas fa-circle"></i>
        </div>
      </div>
    </div>
  </div>

  <!-- État vide -->
  <div class="empty-state" *ngIf="!isLoading && currentEvents.length === 0">
    <div class="empty-icon">
      <i class="fas fa-calendar-alt"></i>
    </div>
    <h3>Aucun événement ce mois-ci</h3>
    <p>Tous les événements et activités apparaîtront ici</p>
  </div>

  <!-- Loading spinner -->
  <div class="loading-spinner" *ngIf="isLoading">
    <div class="spinner"></div>
    <p>Chargement du calendrier...</p>
  </div>
</div>
